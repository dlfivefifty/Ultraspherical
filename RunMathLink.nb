(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[      8478,        224]
NotebookOptionsPosition[      7721,        193]
NotebookOutlinePosition[      8098,        210]
CellTagsIndexPosition[      8055,        207]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[TextData[{
 "This shows how to call the connecting routine with ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\n\nFirst compile the source using \n\ncd Ultraspherical\nmcc ultrasolve.tm \
UltrasphericalMathLink.cpp AdaptiveQR.cpp FilledBandedMatrix.cpp \
MultiplicationMatrices.cpp -o UltrasphericalMathLink\n\n\nWe can now install \
the compiled file:"
}], "Text",
 CellChangeTimes->{{3.5901060237703457`*^9, 3.590106025662459*^9}, {
  3.59010625648219*^9, 3.5901062775321074`*^9}, {3.590106315663307*^9, 
  3.590106355251938*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Install", "[", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
    "\"\</Ultraspherical/UltrasphericalMathLink\>\""}], "]"}], ";"}]], "Input",\

 CellChangeTimes->{{3.5901042482888308`*^9, 3.590104249369298*^9}, {
   3.590106282740717*^9, 3.59010629078444*^9}, 3.590106357943553*^9}],

Cell["\<\
This installs UltrasphericalSolve[{a0,...,an}], which solves the ODE u\
\[CloseCurlyQuote]\[CloseCurlyQuote] + (a0 T0(x) + ... + an Tn(x)) u = 0, \
u(-1) = 1, u(1) = 0.\
\>", "Text",
 CellChangeTimes->{{3.590106362239006*^9, 3.590106390811984*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{"a", "=", 
   RowBox[{"UltrasphericalSolve", "[", 
    RowBox[{"al", "=", 
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", "4"}], "]"}]}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.55193644628471*^9, 3.5519364563290777`*^9}, {
   3.551936545190337*^9, 3.551936558918604*^9}, {3.551936927624596*^9, 
   3.551936991333881*^9}, {3.5519370220244627`*^9, 3.551937055854146*^9}, {
   3.5519371003356733`*^9, 3.551937113012005*^9}, 3.5519371927774277`*^9, {
   3.551937400698358*^9, 3.55193741692968*^9}, {3.5901043756598186`*^9, 
   3.590104401741152*^9}, {3.59010462263177*^9, 3.590104626968265*^9}, {
   3.590106119844716*^9, 3.5901061201326523`*^9}, {3.59010639790405*^9, 
   3.5901063991907063`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.00014599999999999999805190553647804563`2.1849527690640613", ",", 
   RowBox[{"{", 
    RowBox[{"0.4886035566155544`", ",", 
     RowBox[{"-", "0.5025080057040802`"}], ",", 
     RowBox[{"-", "0.01945464307099897`"}], ",", "0.01674213786953441`", ",", 
     "0.040532509111068905`", ",", 
     RowBox[{"-", "0.02065835928678056`"}], ",", 
     RowBox[{"-", "0.009824405000869884`"}], ",", "0.006859218350897698`", 
     ",", "0.0002931258055624258`", ",", 
     RowBox[{"-", "0.0005810093223048057`"}], ",", 
     RowBox[{"-", "0.00016695298481864246`"}], ",", "0.00016984250061406351`",
      ",", "0.00001640669264748643`", ",", 
     RowBox[{"-", "0.000025737953185775272`"}], ",", "3.299355974910873`*^-7",
      ",", "2.2736016218327384`*^-6", ",", "6.57296408832916`*^-8", ",", 
     RowBox[{"-", "3.9899365120671364`*^-7"}], ",", "1.0077098640469077`*^-8",
      ",", "4.194342551266412`*^-8", ",", 
     RowBox[{"-", "3.192530739086138`*^-9"}], ",", 
     RowBox[{"-", "3.412961810404349`*^-9"}], ",", "3.2283846282005946`*^-10",
      ",", "4.410935843646232`*^-10", ",", 
     RowBox[{"-", "4.552086505013507`*^-11"}], ",", 
     RowBox[{"-", "3.6626322794808405`*^-11"}], ",", 
     "5.1908761330732694`*^-12", ",", "2.6642236636775896`*^-12", ",", 
     RowBox[{"-", "5.047006326168634`*^-13"}], ",", 
     RowBox[{"-", "2.787313885647634`*^-13"}], ",", "4.81036644230471`*^-14", 
     ",", "1.9305674409986706`*^-14", ",", 
     RowBox[{"-", "4.160342182098613`*^-15"}], ",", 
     RowBox[{"-", "1.2433181763755784`*^-15"}], ",", 
     "3.5941116654133717`*^-16", ",", "1.1143580442116738`*^-16", ",", 
     RowBox[{"-", "2.7823311995731276`*^-17"}], ",", 
     RowBox[{"-", "6.5798195386804055`*^-18"}], ",", 
     "2.0443586795446453`*^-18", ",", "3.7118840819535283`*^-19", ",", 
     RowBox[{"-", "1.5746968760596647`*^-19"}], ",", 
     RowBox[{"-", "2.9735899690987845`*^-20"}], ",", 
     "1.0505286528974972`*^-20", ",", "1.4915425929534533`*^-21", ",", 
     RowBox[{"-", "6.020033460104116`*^-20"}], ",", 
     RowBox[{"-", "6.444902205681779`*^-21"}], ",", "4.37554165785491`*^-21", 
     ",", "5.224370511015138`*^-22", ",", 
     RowBox[{"-", "2.473179598253263`*^-22"}], ",", 
     RowBox[{"-", "3.1073804931141004`*^-23"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.551936963043796*^9, 3.551936991460312*^9}, {
   3.551937024395402*^9, 3.5519370559792852`*^9}, {3.551937089566627*^9, 
   3.5519371134396257`*^9}, 3.551937193020698*^9, 3.551937267124703*^9, 
   3.5519373127572813`*^9, {3.551937402468524*^9, 3.551937417317227*^9}, 
   3.590104305250708*^9, {3.5901043765651093`*^9, 3.590104401973472*^9}, 
   3.590104438234627*^9, 3.590104627406612*^9, 3.5901060453293056`*^9, 
   3.590106120557917*^9, {3.590106398146896*^9, 3.590106399412579*^9}}]
}, Open  ]],

Cell["\<\
We can compare the error with Mathematica:\
\>", "Text",
 CellChangeTimes->{{3.590106335736815*^9, 3.590106341225615*^9}, {
  3.590106402608924*^9, 3.5901064028142853`*^9}}],

Cell[BoxData[
 RowBox[{"<<", "Ultraspherical`"}]], "Input",
 CellChangeTimes->{{3.5901060526643763`*^9, 3.590106059487393*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"n", "=", 
   RowBox[{"a", "//", "Length"}]}], ";", 
  RowBox[{"Timing", "[", 
   RowBox[{
    RowBox[{"amat", "=", 
     RowBox[{"LinearSolve", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"DirichletOperator", "[", 
             RowBox[{"-", "1"}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", 
             RowBox[{";;", "n"}]}], "\[RightDoubleBracket]"}], ",", 
           RowBox[{
            RowBox[{"DirichletOperator", "[", "1", "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", 
             RowBox[{";;", "n"}]}], "\[RightDoubleBracket]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"DerivativeMatrix", "[", 
             RowBox[{"2", ",", "n"}], "]"}], "+", 
            RowBox[{
             RowBox[{"ConversionMatrix", "[", 
              RowBox[{"2", ",", "n"}], "]"}], ".", 
             RowBox[{"MultiplicationMatrix", "[", 
              RowBox[{"al", ",", "n"}], "]"}]}]}], " ", "//", "Most"}], "//", 
          "Most"}]}], "]"}], ",", 
       RowBox[{"PadRight", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "0"}], "}"}], ",", "n"}], "]"}]}], "]"}]}], ";"}],
    "]"}]}]], "Input",
 CellChangeTimes->{{3.590106089166802*^9, 3.59010609464034*^9}, {
  3.59010613516238*^9, 3.590106204385375*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.01429099999999999988375964932174611022`4.175662532503545", ",", "Null"}],
   "}"}]], "Output",
 CellChangeTimes->{{3.590106161254773*^9, 3.590106204538471*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"amat", "-", "a"}], "//", "Norm"}]], "Input",
 CellChangeTimes->{{3.590106167404665*^9, 3.590106169167658*^9}, {
  3.5901062093027287`*^9, 3.590106210003181*^9}}],

Cell[BoxData["2.0123550608728231`*^-16"], "Output",
 CellChangeTimes->{{3.5901061694283733`*^9, 3.5901062102699757`*^9}}]
}, Open  ]]
},
WindowSize->{740, 756},
WindowMargins->{{209, Automatic}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 545, 11, 201, "Text"],
Cell[1105, 33, 335, 8, 28, "Input"],
Cell[1443, 43, 258, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[1726, 52, 757, 14, 28, "Input"],
Cell[2486, 68, 2830, 48, 207, "Output"]
}, Open  ]],
Cell[5331, 119, 183, 4, 30, "Text"],
Cell[5517, 125, 127, 2, 28, "Input"],
Cell[CellGroupData[{
Cell[5669, 131, 1471, 40, 131, "Input"],
Cell[7143, 173, 205, 5, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7385, 183, 196, 4, 28, "Input"],
Cell[7584, 189, 121, 1, 32, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
